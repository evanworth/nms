<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NMS Period Tracker</title>
  <link rel="manifest" href="/nms/manifest.json">
  <meta name="theme-color" content="#004080" />
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 30px;
      background-color: #f8f9fa;
      color: #333;
    }
    h1 { color: #004080; }
    .clock {
      font-size: 2.5em;
      margin: 20px 0;
    }
    .period-box {
      display: inline-block;
      background: #e3f2fd;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-top: 20px;
    }
    .label { font-size: 1.2em; }
    .time-left { font-size: 1.1em; color: #007bff; }
    .next-period { margin-top: 10px; font-size: 1.1em; color: #28a745; }
    .lunch-box {
      margin-top: 25px;
      background: #fff3cd;
      padding: 15px;
      border-radius: 10px;
      display: inline-block;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <h1>Nissitissit Middle School Period Tracker</h1>
  <div class="clock" id="clock"></div>
  <div class="period-box">
    <div class="label" id="dayType"></div>
    <div class="label" id="currentPeriod"></div>
    <div class="time-left" id="timeRemaining"></div>
    <div class="next-period" id="nextPeriod"></div>
  </div>

  <div class="lunch-box">
    <h3>Lunch Schedule</h3>
    <p>Grade 5: 10:50 - 11:20</p>
    <p>Grade 6: 11:22 - 11:52</p>
    <p>Grade 7: 11:54 - 12:24</p>
    <p>Grade 8: 12:26 - 12:56</p>
  </div>

  <script>
    const schedules = {
      mw: [
        ["1", "08:10", "08:40"],
        ["2", "08:40", "09:30"],
        ["3", "09:30", "10:20"],
        ["4", "10:20", "11:10"],
        ["5", "11:10", "12:00"],
        ["6", "12:00", "12:50"],
        ["7", "12:50", "13:40"],
        ["8", "13:40", "14:25"]
      ],
      ttf: [
        ["1", "08:05", "09:00"],
        ["2", "09:00", "09:55"],
        ["3", "09:55", "10:50"],
        ["4", "10:50", "11:45"],
        ["5", "11:45", "12:40"],
        ["6", "12:40", "13:35"],
        ["7", "13:35", "14:25"]
      ]
    };

    function updateClock() {
      const now = new Date();
      document.getElementById('clock').textContent =
        now.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit', second: '2-digit'});

      const day = now.getDay(); // 1=Mon, 2=Tue, ... 5=Fri
      const isMW = (day === 1 || day === 3);
      const todaySchedule = isMW ? schedules.mw : schedules.ttf;

      if (day === 0 || day === 6) {
        document.getElementById('dayType').textContent = "Weekend Schedule";
        document.getElementById('currentPeriod').textContent = "It's the weekend â€” no school today!";
        document.getElementById('timeRemaining').textContent = "";
        document.getElementById('nextPeriod').textContent = "";
        return;
      }

      document.getElementById('dayType').textContent =
        isMW ? "Monday/Wednesday Schedule" : "Tuesday/Thursday/Friday Schedule";

      const currentTime = now.getHours() * 60 + now.getMinutes();
      let period = "No school right now";
      let timeLeft = "";
      let nextPeriodText = "";

      for (let i = 0; i < todaySchedule.length; i++) {
        const [p, start, end] = todaySchedule[i];
        const [sh, sm] = start.split(':').map(Number);
        const [eh, em] = end.split(':').map(Number);
        const startMins = sh * 60 + sm;
        const endMins = eh * 60 + em;

        if (currentTime >= startMins && currentTime < endMins) {
          period = `Current Period: ${p}`;
          const minsLeft = endMins - currentTime;
          timeLeft = `${minsLeft} min left in this period.`;
          if (i + 1 < todaySchedule.length) {
            const [np, ns] = todaySchedule[i + 1];
            nextPeriodText = `Next Period: ${np} starts at ${todaySchedule[i + 1][1]}`;
          }
          break;
        } else if (currentTime < startMins) {
          period = `Passing Time`;
          const minsUntil = startMins - currentTime;
          nextPeriodText = `Next Period: ${p} starts in ${minsUntil} min.`;
          break;
        }
      }

      document.getElementById('currentPeriod').textContent = period;
      document.getElementById('timeRemaining').textContent = timeLeft;
      document.getElementById('nextPeriod').textContent = nextPeriodText;
    }

    setInterval(updateClock, 1000);
    updateClock();

    // Register service worker for PWA
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/nms/service-worker.js')
        .then(() => console.log('Service worker registered successfully'))
        .catch(err => console.log('Service worker registration failed:', err));
    }
  </script>
</body>
</html>
